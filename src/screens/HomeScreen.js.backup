import React from 'react';
import {
  View,
  Text,
  TouchableOpacity,
  StyleSheet,
} from 'react-native';
import { ResponsiveContainer, ResponsiveGrid, ResponsiveCard, MobileContainer } from '../components/ResponsiveLayout';
import { useResponsive } from '../hooks/useResponsive';
import { isAdmin } from '../services/firebase';

const HomeScreen = ({ setScreen, user }) => {
  const { isWeb, isMobile, getResponsiveValue } = useResponsive();

  // Menu items baseado no tipo de usuário
  const baseMenuItems = [
    {
      title: 'Oferecer Carona',
      description: 'Publique uma carona para outros usuários',
      onPress: () => setScreen('OfferRide'),
      color: '#4299e1',
    },
    {
      title: 'Procurar Carona',
      description: 'Encontre caronas disponíveis',
      onPress: () => setScreen('FindRide'),
      color: '#38b2ac',
    },
    {
      title: 'Gerenciar Passageiros',
      description: 'Gerencie pedidos e caronas ativas',
      onPress: () => setScreen('ManagePassengers'),
      color: '#9f7aea',
    },
    {
      title: 'Histórico de Caronas',
      description: 'Veja suas caronas anteriores',
      onPress: () => setScreen('RideHistory'),
      color: '#f56565',
    },
    {
      title: 'Meu Perfil',
      description: 'Gerencie suas informações',
      onPress: () => setScreen('Profile'),
      color: '#ed8936',
    },
  ];

  // Adiciona painel admin se o usuário for administrador
  const menuItems = user && isAdmin(user) 
    ? [
        ...baseMenuItems.slice(0, -1), // Todos os itens exceto o último (Perfil)
        {
          title: 'Painel Administrativo',
          description: 'Gerencie usuários e sistema',
          onPress: () => setScreen('AdminPanel'),
          color: '#e53e3e',
        },
        baseMenuItems[baseMenuItems.length - 1] // Adiciona Perfil por último
      ]
    : baseMenuItems;

  const renderMenuItem = (item, index) => (
    <ResponsiveCard key={index} style={styles.menuItem}>
      <TouchableOpacity
        style={[styles.menuButton, { backgroundColor: item.color }]}
        onPress={item.onPress}
      >
        <Text style={styles.menuTitle}>{item.title}</Text>
        <Text style={styles.menuDescription}>{item.description}</Text>
      </TouchableOpacity>
    </ResponsiveCard>
  );

  // Use MobileContainer for mobile, ResponsiveContainer for web
  const Container = isMobile ? MobileContainer : ResponsiveContainer;

  return (
    <Container style={styles.container}>
      <Text style={styles.title}>ICEA Caronas</Text>
      <Text style={styles.subtitle}>
        {isWeb ? 'Compartilhe caronas e ajude o meio ambiente' : 'Compartilhe caronas'}
      </Text>
      
      <ResponsiveGrid 
        columns={getResponsiveValue(1, 2, 3)} 
        style={styles.menuGrid}
      >
        {menuItems.map(renderMenuItem)}
      </ResponsiveGrid>

      {/* Show welcome message on mobile since we have bottom navigation */}
      {isMobile && (
        <View style={styles.mobileWelcome}>
          <Text style={styles.welcomeText}>
            Use a navegação abaixo para acessar as funcionalidades
          </Text>
        </View>
      )}
    </Container>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
  },
  title: {
    fontSize: 32,
    fontWeight: 'bold',
    color: '#fff',
    marginBottom: 10,
    textAlign: 'center',
  },
  subtitle: {
    fontSize: 18,
    color: '#a0aec0',
    marginBottom: 40,
    textAlign: 'center',
    paddingHorizontal: 20,
  },
  menuGrid: {
    width: '100%',
  },
  menuItem: {
    marginBottom: 20,
  },
  menuButton: {
    padding: 20,
    borderRadius: 12,
    alignItems: 'center',
    minHeight: 120,
    justifyContent: 'center',
  },
  menuTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#fff',
    marginBottom: 8,
    textAlign: 'center',
  },
  menuDescription: {
    fontSize: 14,
    color: '#e2e8f0',
    textAlign: 'center',
    lineHeight: 20,
  },
  mobileWelcome: {
    marginTop: 20,
    padding: 15,
    backgroundColor: 'rgba(66, 153, 225, 0.1)',
    borderRadius: 8,
    alignItems: 'center',
  },
  welcomeText: {
    color: '#a0aec0',
    fontSize: 14,
    textAlign: 'center',
    lineHeight: 20,
  },
});

export default HomeScreen;
